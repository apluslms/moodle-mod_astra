{"version":3,"sources":["../src/aplus_modal.js"],"names":["$","defaults","loader_selector","loader_text_selector","title_selector","content_selector","error_message_attribute","AplusModal","element","options","settings","extend","init","prototype","loader","find","loaderText","title","content","messages","loading","text","error","attr","run","command","data","open","showError","showContent","hide","removeClass","addClass","show","on","dropdown","modal","jQuery","empty","append","html","fn","each","window","document","moodleEvent","modal_selector","file_modal_selector","body_regexp","file","AplusModalLink","link","event","preventDefault","url","aplusModal","get","highlightCode","match","length","c","aplusModalLink","notifyFilterContentUpdated","fail"],"mappings":"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","sourcesContent":["/**\n * A+ modal dialog classes.\n * \n * Source: A+ (a-plus/assets/js/aplus.js)\n * License: GNU GPL v3\n * \n * @module mod_astra/aplus_modal\n */\nimport jQuery from 'jquery';\nimport * as moodleEvent from 'core/event';\nimport './aplus_highlightcode';\nimport 'theme_boost/bootstrap/dropdown';\nimport 'theme_boost/bootstrap/modal';\n\n/**\n * Handle common modal dialog.\n */\n(function($, window, document, undefined) {\n  //\"use strict\";\n\n  var pluginName = \"aplusModal\";\n  var defaults = {\n    loader_selector: \".modal-progress\",\n    loader_text_selector: \".progress-bar\",\n    title_selector: \".modal-title\",\n    content_selector: \".modal-body\",\n    error_message_attribute: \"data-msg-error\",\n  };\n\n  function AplusModal(element, options) {\n    this.element = $(element);\n    this.settings = $.extend({}, defaults, options);\n    this.init();\n  }\n\n  $.extend(AplusModal.prototype, {\n\n    init: function() {\n      this.loader = this.element.find(this.settings.loader_selector);\n      this.loaderText = this.loader.find(this.settings.loader_text_selector);\n      this.title = this.element.find(this.settings.title_selector);\n      this.content = this.element.find(this.settings.content_selector);\n      this.messages = {\n        loading: this.loaderText.text(),\n        error: this.loaderText.attr(this.settings.error_message_attribute)\n      };\n    },\n\n    run: function(command, data) {\n      switch(command) {\n        case \"open\":\n          this.open(data);\n          break;\n        case \"error\":\n          this.showError(data);\n          break;\n        case \"content\":\n          this.showContent(data);\n          break;\n      }\n    },\n\n    open: function(data) {\n      this.title.hide();\n      this.content.hide();\n      this.loaderText\n        .removeClass('bg-danger').addClass('progress-bar-animated')\n        .text(data || this.messages.loading);\n      this.loader.show();\n      this.element.on(\"hidden.bs.modal\", function(event) {\n        $(\".dropdown-toggle\").dropdown();\n      });\n      this.element.modal(\"show\");\n    },\n\n    showError: function(data) {\n      this.loaderText\n        .removeClass('progress-bar-animated').addClass('bg-danger')\n        .text(data || this.messages.error);\n    },\n\n    showContent: function(data) {\n      this.loader.hide();\n      if (data.title) {\n        this.title.text(data.title);\n        this.title.show();\n      }\n      if (data.content instanceof jQuery) {\n        this.content.empty().append(data.content);\n      } else {\n        this.content.html(data.content);\n      }\n      this.content.show();\n      return this.content;\n    }\n  });\n\n  $.fn[pluginName] = function(command, data, options) {\n    return this.each(function() {\n      var modal = $.data(this, \"plugin_\" + pluginName);\n      if (!modal) {\n        modal = new AplusModal(this, options);\n        $.data(this, \"plugin_\" + pluginName, modal);\n      }\n      return modal.run(command, data);\n    });\n  };\n})(jQuery, window, document);\n\n/**\n * Open links in a modal.\n */\n(function($, moodleEvent, window, document, undefined) {\n    //\"use strict\";\n\n    var pluginName = \"aplusModalLink\";\n    var defaults = {\n        modal_selector: \"#page-modal\",\n        file_modal_selector: \"#file-modal\",\n        body_regexp: /<body[^>]*>([\\s\\S]*)<\\/body>/i,\n        file: false\n    };\n\n  function AplusModalLink(element, options) {\n    this.element = $(element);\n    this.settings = $.extend({}, defaults, options);\n    this.init();\n  }\n\n  $.extend(AplusModalLink.prototype, {\n    init: function() {\n      var link = this.element;\n      var settings = this.settings;\n      link.on(\"click\", function(event) {\n        event.preventDefault();\n        var url = link.attr(\"href\");\n        if (url === \"\" || url == \"#\") {\n          return false;\n        }\n        var modal = $(settings.file ? settings.file_modal_selector : settings.modal_selector);\n        modal.aplusModal(\"open\");\n        $.get(url, function(data) {\n          if (settings.file) {\n            var text = $(\"<pre/>\").text(data);\n            modal.aplusModal(\"content\", {\n              title: link.text(),\n              content: text,\n            });\n            text.highlightCode();\n          } else {\n            var match = data.match(settings.body_regexp);\n            if (match !== null && match.length == 2) {\n              data = match[1];\n            }\n            var c = modal.aplusModal(\"content\", { content: data });\n            c.find('.file-modal').aplusModalLink({file:true});\n            c.find('pre.hljs').highlightCode();\n            // changed from A+: render MathJax formulas in the modal content retrieved from the URL\n            moodleEvent.notifyFilterContentUpdated(settings.modal_selector);\n          }\n        }).fail(function() {\n          modal.aplusModal(\"error\");\n        });\n      });\n    }\n  });\n\n  $.fn[pluginName] = function(options) {\n    return this.each(function() {\n      if (!$.data(this, \"plugin_\" + pluginName)) {\n        $.data(this, \"plugin_\" + pluginName, new AplusModalLink(this, options));\n      }\n    });\n  };\n})(jQuery, moodleEvent, window, document);\n\n"],"file":"aplus_modal.min.js"}