{"version":3,"sources":["../src/aplus_chapter.js"],"names":["window","CustomEvent","event","params","bubbles","cancelable","detail","evt","document","createEvent","initCustomEvent","prototype","Event","$","moodleEvent","defaults","chapter_url_attr","exercise_url_attr","active_element_attr","loading_selector","quiz_success_selector","message_attr","load","submit","error","modal_selector","AplusChapter","element","options","dom_element","settings","extend","ajaxForms","url","modalElement","loader","messages","quizSuccess","aeOutputs","init","FormData","attr","readMessages","find","aplusExercise","input","exercises","length","dispatchEvent","exercisesIndex","exercisesSize","nextExercise","type","eq","aplusExerciseLoad","key","cloneLoader","clone","removeAttr","show","openModal","message","aplusModal","modalError","modalContent","content","renderMath","modalSuccess","exercise","badge","removeClass","empty","append","hasClass","css","hide","notifyFilterContentUpdated","fn","each","data","jQuery","quiz_attr","ajax_attr","message_selector","content_element","content_selector","exercise_selector","summary_selector","response_selector","navigation_selector","dropdown_selector","last_submission_selector","ae_result_selector","submission_point_badges_selector","AplusExercise","chapter","quiz","ajax","active_element","chapterID","exercise_type","height","addEventListener","dataType","done","updateSummary","makeInputForm","id","title","def_val","wrap","form","first_div","label","html","form_field","val","substring","split","pop","i","opt","option","text","second_div","button","onlyThis","showLoader","hideLoader","input_form","update","loadLastSubmission","fail","filter","contents","remove","prependTo","cur_height","cont_height","scrollHeight","bindNavEvents","bindFormEvents","aplusModalLink","dropdown","forms","on","preventDefault","postMessage","submitAjax","formData","callback","retry","contentType","processData","xhr","status","setTimeout","feedback","updateOutput","collectFormData","output","tmpInputs","matchInputs","inputs","expected_inputs","input_id","valid","input_val","input_elem","input_field","hasAttribute","trim","get","files","form_element","outputs","tmpCollect","output_id","out_content","pollerElem","poll_url","ready_url","updateSubmission","indexOf","grep","a","aplusExerciseDetectWaits","did_wait","suburl","dispatchEventToActiveElem","input2","new_badges","old_badges","replaceWith","is","output_container","updateInputs","submission_data","exer","input_list","grader_inputs","hasOwnProperty","inArray","input_data","trigger","inputIds","inputId","inputElem","link","data_type","m","match","console","messageType","addClass","e","target","$form","prop"],"mappings":"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","sourcesContent":["/**\n * A+ chapter learning object with embedded exercises as an ES6 module for Moodle.\n * The exercises are downloaded asynchronously (AJAX) and inserted in the DOM.\n * \n * In an HTML page, run the following JS code once to activate it:\n * // Construct the page chapter element.\n * jQuery(function() { jQuery(\"#exercise-page-content\").aplusChapter(); });\n * \n * Source: A+ (a-plus/exercise/static/exercise/chapter.js)\n * License: GNU GPL v3\n * \n * @module mod_astra/aplus_chapter\n */\n\nimport jQuery from 'jquery';\nimport * as moodleEvent from 'core/event';\nimport './aplus_poll';\nimport 'theme_boost/bootstrap/dropdown';\nimport './aplus_modal';\n\n/** Add CustomEvent for IE 11\n *  Source: A+ (a-plus/assets/js/aplus.js)\n */\n(function () {\n\tif (typeof window.CustomEvent === \"function\") return false;\n\tfunction CustomEvent(event, params) {\n\t\tvar bubbles = params.bubbles !== undefined ? params.bubbles : false;\n\t\tvar cancelable = params.cancelable !== undefined ? params.cancelable : false;\n\t\tvar detail = params.detail !== undefined ? params.detail : undefined;\n\t\tvar evt = document.createEvent( 'CustomEvent' );\n\t\tevt.initCustomEvent(event, bubbles, cancelable, detail);\n\t\treturn evt;\n\t}\n\tCustomEvent.prototype = window.Event.prototype;\n\twindow.CustomEvent = CustomEvent;\n})();\n\n/**\n * Chapter element containing number of exercise elements.\n *\n */\n;(function($, moodleEvent, window, document, undefined) {\n\t\"use strict\";\n\n\tvar pluginName = \"aplusChapter\";\n\tvar defaults = {\n\t\tchapter_url_attr: \"data-aplus-chapter\",\n\t\texercise_url_attr: \"data-aplus-exercise\",\n\t\tactive_element_attr: \"data-aplus-active-element\",\n\t\tloading_selector: \"#loading-indicator\",\n\t\tquiz_success_selector: \"#quiz-success\",\n\t\tmessage_attr: {\n\t\t\tload: \"data-msg-load\",\n\t\t\tsubmit: \"data-msg-submit\",\n\t\t\terror: \"data-msg-error\"\n\t\t},\n\t\tmodal_selector: \"#page-modal\",\n\t};\n\n\tfunction AplusChapter(element, options) {\n\t\tthis.dom_element = element;\n\t\tthis.element = $(element);\n\t\tthis.settings = $.extend({}, defaults, options);\n\t\tthis.ajaxForms = false;\n\t\tthis.url = null;\n\t\tthis.modalElement = null;\n\t\tthis.loader = null;\n\t\tthis.messages = null;\n\t\tthis.quizSuccess = null;\n\t\tthis.aeOutputs = {}; // Add active element outputs to chapter so they can be found by id later.\n\t\tthis.init();\n\t}\n\n\t$.extend(AplusChapter.prototype, {\n\n\t\t/**\n\t\t * Constructs contained exercise elements.\n\t\t */\n\t\tinit: function() {\n\t\t\tthis.ajaxForms = window.FormData ? true : false;\n\t\t\tthis.url = this.element.attr(this.settings.chapter_url_attr);\n\t\t\tthis.modalElement = $(this.settings.modal_selector);\n\t\t\tthis.loader = $(this.settings.loading_selector);\n\t\t\tthis.messages = this.readMessages();\n\t\t\tthis.quizSuccess = $(this.settings.quiz_success_selector);\n\t\t\t\n\t\t\t// do not include active element inputs to exercise groups\n\t\t\tthis.element.find(\"[\" + this.settings.active_element_attr + \"='in']\").aplusExercise(this, {input: true});\n\t\t\t\n\t\t\tvar exercises = this.element.find(\"[\" + this.settings.exercise_url_attr + \"]\");\n\t\t\tif (exercises.length > 0) {\n\t\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\t\tnew CustomEvent(\"aplus:chapter-loaded\", {bubbles: true}));\n\n\t\t\t\texercises.aplusExercise(this);\n\t\t\t\tthis.exercises = exercises;\n\t\t\t\tthis.exercisesIndex = 0;\n\t\t\t\tthis.exercisesSize = exercises.length;\n\t\t\t\tthis.nextExercise();\n\t\t\t} else {\n\t\t\t\tvar type = 'text/x.aplus-exercise';\n\t\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\t\tnew CustomEvent(\"aplus:exercise-loaded\", {bubbles: true, detail: {type: type}}));\n\t\t\t\t//$.augmentSubmitButton($(\".exercise-column\"));\n\t\t\t\t// changed from A+: no group submissions and no group selection UI\n\t\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\t\tnew CustomEvent(\"aplus:exercise-ready\", {bubbles: true, detail: {type: type}}));\n\t\t\t}\n\t\t},\n\n\t\tnextExercise: function() {\n\t\t\tif (this.exercisesIndex < this.exercisesSize) {\n\t\t\t\tthis.exercises.eq(this.exercisesIndex).aplusExerciseLoad();\n\t\t\t\tthis.exercisesIndex++;\n\t\t\t}\n\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\tnew CustomEvent(\"aplus:chapter-ready\", {bubbles: true}));\n\t\t},\n\n\t\treadMessages: function() {\n\t\t\tvar messages = {};\n\t\t\tfor (var key in this.settings.message_attr) {\n\t\t\t\tmessages[key] = this.loader.attr(this.settings.message_attr[key]);\n\t\t\t}\n\t\t\treturn messages;\n\t\t},\n\n\t\tcloneLoader: function(msgType) {\n\t\t\treturn $(this.settings.loading_selector)\n\t\t\t\t.clone().removeAttr(\"id\").show();\n\t\t},\n\n\t\topenModal: function(message) {\n\t\t\tthis.modalElement.aplusModal(\"open\", message);\n\t\t},\n\n\t\tmodalError: function(message) {\n\t\t\tthis.modalElement.aplusModal(\"error\", message);\n\t\t},\n\n\t\tmodalContent: function(content) {\n\t\t\tthis.modalElement.aplusModal(\"content\", { content: content });\n\t\t\tthis.renderMath();\n\t\t},\n\n\t\tmodalSuccess: function(exercise, badge) {\n\t\t\t/*this.modalElement.one(\"hidden.bs.modal\", function(event) {\n\t\t\t\t$(document.body).animate({\n\t\t\t\t\t'scrollTop': exercise.offset().top\n\t\t\t\t}, 300);\n\t\t\t});*/\n\t\t\tvar content = this.quizSuccess.clone()\n\t\t\t\t.attr(\"class\", exercise.attr(\"class\"))\n\t\t\t\t.removeClass(\"exercise\")\n\t\t\t\t.removeAttr(\"id\")\n\t\t\t\t.show();\n\t\t\tcontent.find('.badge-placeholder').empty().append(badge);\n\t\t\tif (badge.hasClass(\"badge-success\") || badge.hasClass(\"badge-warning\")) {\n\t\t\t\tcontent.find('.btn-success').css('display', 'block');\n\t\t\t} else {\n\t\t\t\tcontent.find('.btn-success').hide();\n\t\t\t}\n\t\t\tthis.modalContent(content);\n\t\t},\n\n\t\trenderMath: function() {\n\t\t\t// changed from A+: Moodle has its own API for accessing MathJax.\n\t\t\t// Trigger Moodle JS event so that MathJax renders new formulas\n\t\t\t// that are inserted into the modal dialog (openModal appends the modal content\n\t\t\t// at runtime).\n\t\t\t// This uses the Moodle filter MathJax loader.\n\t\t\tmoodleEvent.notifyFilterContentUpdated(this.settings.modal_selector);\n\t\t},\n\t});\n\n\t$.fn[pluginName] = function(options) {\n\t\treturn this.each(function() {\n\t\t\tif (!$.data(this, \"plugin_\" + pluginName)) {\n\t\t\t\t$.data(this, \"plugin_\" + pluginName, new AplusChapter(this, options));\n\t\t\t}\n\t\t});\n\t};\n\n})(jQuery, moodleEvent, window, document);\n\n/**\n * Exercise element inside chapter.\n *\n */\n;(function($, moodleEvent, window, document, undefined) {\n\t\"use strict\";\n\n\tvar pluginName = \"aplusExercise\";\n\tvar loadName = \"aplusExerciseLoad\";\n\tvar defaults = {\n\t\tquiz_attr: \"data-aplus-quiz\",\n\t\tajax_attr: \"data-aplus-ajax\",\n\t\tmessage_selector: \".progress-bar\",\n\t\tcontent_element: '<div class=\"exercise-content\"></div>',\n\t\tcontent_selector: '.exercise-content',\n\t\texercise_selector: '#exercise-all',\n\t\tsummary_selector: '.exercise-summary',\n\t\tresponse_selector: '.exercise-response',\n\t\tnavigation_selector: 'ul.exercise-nav a[class!=\"dropdown-toggle\"]',\n\t\tdropdown_selector: 'ul.exercise-nav .dropdown-toggle',\n\t\tlast_submission_selector: 'ul.exercise-nav .dropdown-menu a:first-child',\n\t\t// For active elements:\n\t\tactive_element_attr: \"data-aplus-active-element\",\n\t\tae_result_selector: '.ae_result',\n\t\tinput: false, // determines whether the active element is an input element or not\n\t\tsubmission_point_badges_selector: \"[data-points-badge] .badge\", // summary and latest submission points in submission_plain.mustache\n\t};\n\n\tfunction AplusExercise(element, chapter, options) {\n\t\tthis.dom_element = element;\n\t\tthis.element = $(element);\n\t\tthis.chapter = chapter;\n\t\tthis.settings = $.extend({}, defaults, options);\n\t\tthis.url = null;\n\t\tthis.quiz = false;\n\t\tthis.ajax = false;\n\t\tthis.active_element = false;\n\t\tthis.loader = null;\n\t\tthis.messages = {};\n\t\tthis.init();\n\t}\n\n\t$.extend(AplusExercise.prototype, {\n\n\t\tinit: function() {\n\t\t\tthis.chapterID = this.element.attr(\"id\");\n\t\t\tthis.url = this.element.attr(this.chapter.settings.exercise_url_attr);\n\t\t\t//this.url = this.url + \"?__r=\" + encodeURIComponent(\n\t\t\t//\twindow.location.href + \"#\" + this.element.attr(\"id\"));\n\t\t\t// changed from A+: URL has no __r GET query parameter\n\n\t\t\t// In quiz mode feedback replaces the exercise.\n\t\t\tthis.quiz = (this.element.attr(this.settings.quiz_attr) !== undefined);\n\n\t\t\t// Do not mess up events in an Ajax exercise.\n\t\t\tthis.ajax = (this.element.attr(this.settings.ajax_attr) !== undefined);\n\t\t\t\n\t\t\t// Check if the exercise is an active element.\n\t\t\tthis.active_element = (this.element.attr(this.settings.active_element_attr) !== undefined);\n\n\t\t\t// set exercise mime type\n\t\t\tthis.exercise_type =\n\t\t\t\tthis.quiz ? 'text/x.aplus-exercise.quiz.v1' :\n\t\t\t\tthis.ajax ? 'text/x.aplus-exercise.iframe.v1' :\n\t\t\t\tthis.active_element ? 'text/x.aplus-exercise.active-element.v1' :\n\t\t\t\t'text/x.aplus-exercise';\n\n\t\t\t// Add the active element outputs to a list so that the element can be found later\n\t\t\tif (this.active_element && !this.settings.input) this.chapter.aeOutputs[this.chapterID] = this;\n\n\t\t\tthis.loader = this.chapter.cloneLoader();\n\t\t\tthis.element.height(this.element.height()).empty();\n\t\t\tthis.element.append(this.settings.content_element);\n\t\t\tthis.element.append(this.loader);\n\t\t\t\n\t\t\t// Inputs are different from actual exercises and need only be loaded.\n\t\t\tif (this.settings.input) this.load();\n\n\t\t\tif (!this.active_element && this.ajax) {\n\t\t\t\t// Add an Ajax exercise event listener to refresh the summary.\n\t\t\t\tvar exercise = this;\n\t\t\t\twindow.addEventListener(\"message\", function (event) {\n\t\t\t\t\tif (event.data.type === \"a-plus-refresh-stats\") {\n\t\t\t\t\t\t$.ajax(exercise.url, {dataType: \"html\"})\n\t\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\t\texercise.updateSummary($(data));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t// Construct an active element input form\n\t\tmakeInputForm: function(id, title, type, def_val) {\n\t\t\tvar wrap = $(\"<div>\");\n\t\t\twrap.attr(\"id\", \"exercise-all\");\n\n\t\t\tvar form = $(\"<form>\");\n\t\t\tform.attr(\"action\", \"\");\n\t\t\tform.attr(\"method\", \"post\");\n\n\t\t\tvar first_div = $(\"<div>\");\n\t\t\tfirst_div.attr(\"class\", \"form-group\");\n\n\t\t\tvar label = $(\"<label>\");\n\t\t\tlabel.attr(\"class\", \"control-label\");\n\t\t\tlabel.attr(\"for\", id + \"_input\");\n\t\t\tlabel.html(title);\n\n\t\t\tvar form_field;\n\t\t\tif (!type || type === \"clickable\") {\n\t\t\t\tform_field = $(\"<textarea>\");\n\t\t\t\tform_field.val(def_val);\n\t\t\t} else if (type === \"file\") {\n\t\t\t\tform_field = $(\"<input>\");\n\t\t\t\tform_field.attr(\"type\", \"file\");\n\t\t\t\tform.attr(\"enctype\", \"multipart/form-data\");\n\t\t\t} else if (type.substring(0, 8) == \"dropdown\") {\n\t\t\t\tform_field = $(\"<select>\");\n\t\t\t\t// If the type is dropdown, the format of the type attribute\n\t\t\t\t// should be \"dropdown:option1,option2,option2,..\"\n\t\t\t\tvar options = type.split(\":\").pop().split(\",\");\n\t\t\t\t$.each(options, function(i, opt) {\n\t\t\t\t\tvar option = $(\"<option>\");\n\t\t\t\t\toption.text(opt);\n\t\t\t\t\toption.val(opt);\n\t\t\t\t\tform_field.append(option);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tform_field.attr(\"class\", \"form-control\");\n\t\t\tform_field.attr(\"id\", id + \"_input_id\");\n\t\t\tform_field.attr(\"name\", id + \"_input\");\n\n\t\t\tvar second_div = $(\"<div>\");\n\t\t\tfirst_div.attr(\"class\", \"form-group\");\n\n\t\t\tvar button = $(\"<input>\");\n\t\t\tbutton.attr(\"class\", \"btn btn-primary\");\n\t\t\tbutton.attr(\"value\", \"Submit\");\n\t\t\tbutton.attr(\"type\", \"submit\");\n\n\t\t\t$(first_div).append(label, form_field);\n\t\t\t$(second_div).append(button);\n\t\t\t$(form).append(first_div, second_div);\n\t\t\t$(wrap).append(form);\n\n\t\t\treturn $(wrap);\n\t\t},\n\n\t\tload: function(onlyThis) {\n\t\t\tthis.showLoader(\"load\");\n\t\t\tvar exercise = this;\n\n\t\t\tif (exercise.settings.input) {\n\t\t\t\tvar title = exercise.element.data(\"title\");\n\t\t\t\tvar type = exercise.element.data(\"type\");\n\t\t\t\tvar def_val = exercise.element.data(\"default\");\n\n\t\t\t\tif (!title) title = '';\n\t\t\t\tif (!def_val) def_val = '';\n\n\t\t\t\texercise.hideLoader();\n\t\t\t\tvar input_form = exercise.makeInputForm(exercise.chapterID, title, type, def_val);\n\t\t\t\texercise.update(input_form);\n\t\t\t\texercise.loadLastSubmission(input_form);\n\t\t\t\tif (!onlyThis) exercise.chapter.nextExercise();\n\t\t\t} else {\n\t\t\t\t$.ajax(this.url, {dataType: \"html\"})\n\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\texercise.showLoader(\"error\");\n\t\t\t\t\t\tif (!onlyThis) exercise.chapter.nextExercise();\n\t\t\t\t\t})\n\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\texercise.hideLoader();\n\t\t\t\t\t\texercise.update($(data));\n\t\t\t\t\t\tif (exercise.quiz || exercise.active_element) {\n\t\t\t\t\t\t\texercise.loadLastSubmission($(data));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texercise.renderMath();\n\t\t\t\t\t\t\tif (!onlyThis) exercise.chapter.nextExercise();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tupdate: function(input) {\n\t\t\tvar exercise = this;\n\t\t\tinput = input.filter(exercise.settings.exercise_selector).contents();\n\t\t\tvar content = exercise.element.find(exercise.settings.content_selector)\n\t\t\t\t.empty().append(input).hide();\n\n\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\tnew CustomEvent(\"aplus:exercise-loaded\", {bubbles: true, detail: {type: this.exercise_type}}));\n\n\t\t\tif (exercise.active_element) {\n\t\t\t\tvar title = \"\";\n\t\t\t\tif (exercise.element.attr(\"data-title\"))\n\t\t\t\t\ttitle = \"<p><b>\" + exercise.element.attr(\"data-title\") + \"</b></p>\";\n\t\t\t\texercise.element.find(exercise.settings.summary_selector).remove();\n\t\t\t\t$(title).prependTo(exercise.element.find(exercise.settings.response_selector));\n\t\t\t}\n\n\t\t\tcontent.show();\n\n\t\t\t// Active element can have height settings in the A+ exercise div that need to be\n\t\t\t// attached to correct DOM-elements before setting the exercise container div height to auto\n\t\t\tvar cur_height = exercise.element.css('height');\n\t\t\tif (exercise.active_element) {\n\t\t\t\tif (exercise.settings.input) {\n\t\t\t\t\t$(\"#\" + exercise.chapterID + \" textarea\").css(\"height\", cur_height);\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof $(\"#\" + exercise.chapterID).data(\"scale\") != \"undefined\") {\n\t\t\t\t\t\tvar cont_height = $(exercise.settings.ae_result_selector, exercise.element)[0].scrollHeight;\n\t\t\t\t\t\t$(exercise.settings.ae_result_selector, exercise.element).css({ \"height\" : cont_height +\"px\"});\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(exercise.settings.ae_result_selector, exercise.element).css(\"height\", cur_height);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tthis.element.height(\"auto\");\n\t\t\tthis.bindNavEvents();\n\t\t\tthis.bindFormEvents(content);\n\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\tnew CustomEvent(\"aplus:exercise-ready\", {bubbles: true, detail: {type: this.exercise_type}}));\n\t\t},\n\n\t\tbindNavEvents: function() {\n\t\t\tthis.element.find(this.settings.navigation_selector).aplusModalLink();\n\t\t\tthis.element.find(this.settings.dropdown_selector).dropdown();\n\t\t\tthis.element.find('.page-modal').aplusModalLink();\n\t\t},\n\n\t\tbindFormEvents: function(content) {\n\t\t\tif (!this.ajax) {\n\t\t\t\tvar forms = content.find(\"form\").attr(\"action\", this.url);\n\t\t\t\t// changed from A+: no overlay messages on top of the exercise in Astra.\n\t\t\t\t// In addition, no need to check that the form does not belong\n\t\t\t\t// to an external LTI exercise since Astra does not support LTI exercises.\n\t\t\t\tvar exercise = this;\n\t\t\t\tif (this.chapter.ajaxForms) {\n\t\t\t\t\tforms.on(\"submit\", function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\texercise.submit(this);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t//$.augmentSubmitButton(content);\n\t\t\t// changed from A+: no group submissions and no group selection UI\n\t\t\twindow.postMessage({\n\t\t\t\ttype: \"a-plus-bind-exercise\",\n\t\t\t\tid: this.chapterID\n\t\t\t}, \"*\");\n\t\t},\n\n\t\t// Submit the formData to given url and then execute the callback.\n\t\tsubmitAjax: function(url, formData, callback, retry) {\n\t\t\tvar exercise = this;\n\t\t\t$.ajax(url, {\n\t\t\t\ttype: \"POST\",\n\t\t\t\tdata: formData,\n\t\t\t\tcontentType: false,\n\t\t\t\tprocessData: false,\n\t\t\t\tdataType: \"html\",\n\t\t\t}).fail(function(xhr, textStatus, errorThrown) {\n\t\t\t\t// Retry a few times if submission is not successful\n\t\t\t\tretry = retry || 0;\n\t\t\t\tif (xhr.status !== 200 && retry < 5) {\n\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\texercise.submitAjax(url, formData, callback, retry + 1);\n\t\t\t\t\t\t}, 100);\n\t\t\t\t}\n\t\t\t\t//$(form_element).find(\":input\").prop(\"disabled\", false);\n\t\t\t\t//exercise.showLoader(\"error\");\n\n\t\t\t\tif (!exercise.active_element) {\n\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\tnew CustomEvent(\"aplus:exercise-submission-failure\",\n\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\texercise.chapter.modalError(exercise.chapter.messages.error);\n\t\t\t\t} else {\n\t\t\t\t\t// active elements don't use loadbar so the error message must be shown\n\t\t\t\t\t// in the element container\n\t\t\t\t\tvar feedback = $(\"<div>\");\n\t\t\t\t\tfeedback.attr('id', 'feedback');\n\t\t\t\t\tfeedback.append(exercise.chapter.messages.error);\n\t\t\t\t\texercise.updateOutput(feedback);\n\t\t\t\t}\n\t\t\t}).done(function (data) {\n\t\t\t\tcallback(data);\n\t\t\t});\n\t\t},\n\n\t\t// Construct form data from input element values\n\t\tcollectFormData: function(output, form_element) {\n\t\t\toutput = $(output);\n\n\t\t\t//var [exercise, inputs, expected_inputs] = this.matchInputs(output); // ECMAScript 6\n\t\t\tvar tmpInputs = this.matchInputs(output);\n\t\t\tvar exercise        = tmpInputs[0],\n\t\t\t    inputs          = tmpInputs[1],\n\t\t\t    expected_inputs = tmpInputs[2];\n\n\t\t\t// Form data to be sent for evaluation\n\t\t\tvar formData = new FormData();\n\t\t\tvar input_id = this.chapterID;\n\t\t\tvar valid = true;\n\n\t\t\t$.each(inputs, function(i, id) {\n\t\t\t\tvar input_val;\n\t\t\t\tvar input_elem = $.find(\"#\" + id);\n\t\t\t\tvar input_field = $(\"#\" + id + \"_input_id\");\n\n\t\t\t\t// Input can be also an output element, in which case the content must be\n\t\t\t\t// retrieved differently\n\t\t\t\tif (input_elem[0].hasAttribute(\"data-inputs\")) {\n\n\t\t\t\t\t// If an output uses another output as an input, the output used as an input can\n\t\t\t\t\t// be in evaluation which means this output cannot be evaluated yet\n\t\t\t\t\tif ($(input_elem).data(\"evaluating\")) {\n\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t\tformData = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tinput_val = $(input_elem).find(\".ae_result\").text().trim();\n\n\t\t\t\t} else if ($(input_elem).data(\"type\") === \"file\") {\n\t\t\t\t\tinput_val = input_field.get(0).files[0];\n\n\t\t\t\t} else if (id !== input_id) {\n\t\t\t\t\tinput_val = input_field.val();\n\t\t\t\t\t// Because changing an input value without submitting said input is possible,\n\t\t\t\t\t// use the latest input value that has been submitted before, if there is one,\n\t\t\t\t\t// for other inputs than the one being submitted now.\n\t\t\t\t\tif ($(input_elem).data(\"value\")) input_val = $(input_elem).data(\"value\");\n\t\t\t\t\t// Update the input box back to the value used in evaluation\n\t\t\t\t\tinput_field.val(input_val);\n\t\t\t\t} else {\n\t\t\t\t\tinput_val = input_field.val();\n\t\t\t\t\t// Update the saved value data\n\t\t\t\t\t$(input_elem).data(\"value\", input_val);\n\t\t\t\t}\n\t\t\t\tif (!input_val) valid = false;\n\t\t\t\tif (formData) formData.append(expected_inputs[i], input_val);\n\t\t\t});\n\n\t\t\treturn [exercise, valid, formData];\n\t\t},\n\n\t\tsubmit: function(form_element) {\n\t\t\tvar input = this;\n\t\t\tvar chapter = this.chapter;\n\t\t\tif (this.active_element) {\n\t\t\t\tvar input_id = this.chapterID;\n\t\t\t\t// For every output related to this input, try to evaluate the outputs\n\t\t\t\tvar outputs = $.find('[data-inputs~=\"' + input_id + '\"]');\n\n\t\t\t\t$.each(outputs,\tfunction(i, element) {\n\t\t\t\t\t//var [exercise, valid, formData] = input.collectFormData(element, form_element); // ECMAScript 6\n\t\t\t\t\tvar tmpCollect = input.collectFormData(element, form_element);\n\t\t\t\t\tvar exercise = tmpCollect[0],\n\t\t\t\t\t    valid    = tmpCollect[1],\n\t\t\t\t\t    formData = tmpCollect[2];\n\n\t\t\t\t\tvar output_id = exercise.chapterID;\n\t\t\t\t\tvar output = $(\"#\" + output_id);\n\t\t\t\t\tvar out_content = output.find(exercise.settings.ae_result_selector);\n\t\t\t\t\t// Indicates that one of inputs has not finished evaluation\n\t\t\t\t\tif (!valid && !formData) {\n\t\t\t\t\t\treturn; // TODO should this do something else?\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\t$(\"#\" + output_id).find(exercise.settings.ae_result_selector)\n\t\t\t\t\t\t\t.html('<p style=\"color:red;\">Fill out all the inputs</p>');\n\t\t\t\t\t\t// Abort submission because some required active element input has no value.\n\t\t\t\t\t\tinput.dom_element.dispatchEvent(\n\t\t\t\t\t\t\tnew CustomEvent(\"aplus:submission-aborted\",\n\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: input.exercise_type}}));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.data('evaluating', true);\n\t\t\t\t\t// If the element has no height defined it should keep the height it had with content\n\t\t\t\t\tif (typeof output.data(\"scale\") != \"undefined\") {\n\t\t\t\t\t\tout_content.css({ 'height' : (out_content.height())});\n\t\t\t\t\t}\n\t\t\t\t\tout_content.html(\"<p>Evaluating</p>\");\n\n\t\t\t\t\tvar url = exercise.url;\n\t\t\t\t\texercise.submitAjax(url, formData, function(data) {\n\t\t\t\t\t\tvar content = $(data);\n\t\t\t\t\t\tif (! content.find('.alert-danger').length) {\n\t\t\t\t\t\t\t// changed from A+: must provide the poll URL and the final download URL separately.\n\t\t\t\t\t\t\tvar pollerElem = content.find(\".exercise-wait\");\n\t\t\t\t\t\t\tvar poll_url = pollerElem.attr(\"data-poll-url\");\n\t\t\t\t\t\t\tvar ready_url = pollerElem.attr(\"data-ready-url\");\n\t\t\t\t\t\t\toutput.attr('data-poll-url', poll_url);\n\t\t\t\t\t\t\toutput.attr('data-ready-url', ready_url);\n\n\t\t\t\t\t\t\texercise.updateSubmission(content);\n\t\t\t\t\t\t} else if (content.find('.alert-danger').contents().text()\n\t\t\t\t\t\t\t\t.indexOf(\"The grading queue is not configured.\") >= 0) {\n\t\t\t\t\t\t\toutput.find(exercise.settings.ae_result_selector)\n\t\t\t\t\t\t\t\t.html(content.find(\".alert\").text());\n\t\t\t\t\t\t\toutput.find(exercise.settings.ae_result_selector).append(content.find(\".grading-task\").text());\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toutput.find(exercise.settings.ae_result_selector)\n\t\t\t\t\t\t\t\t.html(content.find('.alert-danger').contents());\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tchapter.openModal(chapter.messages.submit);\n\t\t\t\tvar exercise = this;\n\t\t\t\tvar url = $(form_element).attr(\"action\");\n\t\t\t\tvar formData = new FormData(form_element);\n\n\t\t\t\texercise.submitAjax(url, formData, function(data) {\n\t\t\t\t\t//$(form_element).find(\":input\").prop(\"disabled\", false);\n\t\t\t\t\t//exercise.hideLoader();\n\t\t\t\t\tvar input = $(data);\n\t\t\t\t\tif (exercise.quiz) {\n\t\t\t\t\t\tvar badge = input.find('.badge').eq(2).clone();\n\t\t\t\t\t\texercise.update(input);\n\t\t\t\t\t\tchapter.modalSuccess(exercise.element, badge);\n\t\t\t\t\t\texercise.renderMath();\n\t\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\t\tnew CustomEvent(\"aplus:submission-finished\",\n\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\texercise.updateSubmission(input);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\t// Find for an active element the names of the input fields required and\n\t\t// the corresponding names that are used in mooc-grader exercise type config\n\t\tmatchInputs: function(element) {\n\t\t\tvar output_id = element.attr(\"id\");\n\t\t\tvar exercise = this.chapter.aeOutputs[output_id];\n\t\t\t// Find the ids of input elements required for this output\n\t\t\tvar inputs = element.attr(\"data-inputs\").split(\" \");\n\t\t\t// Find the form field names the grader is expecting\n\t\t\tvar expected_inputs = element.find(exercise.settings.ae_result_selector).attr(\"data-expected-inputs\");\n\t\t\t// make sure there are expected inputs\n\t\t\tif (expected_inputs) {\n\t\t\t\texpected_inputs = expected_inputs.trim().split(\" \");\n\t\t\t\t// There might be extra whitespace or line breaks in the expected inputs data-attribute\n\t\t\t\t// because of how the template is generated\n\t\t\t\texpected_inputs = $.grep(expected_inputs, function( a ) {\n\t\t\t\t\treturn a !== \"\" || a !== \"\\n\";\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\texpected_inputs = [];\n\t\t\t}\n\t\t\treturn [exercise, inputs, expected_inputs];\n\t\t},\n\n\t\tupdateSummary: function(input) {\n\t\t\tthis.element.find(this.settings.summary_selector)\n\t\t\t\t.empty().append(\n\t\t\t\t\tinput.find(this.settings.summary_selector).remove().contents()\n\t\t\t\t);\n\t\t\tthis.bindNavEvents();\n\t\t},\n\n\t\tupdateSubmission: function(input) {\n\t\t\tif (!this.active_element) {\n\t\t\t\tthis.updateSummary(input);\n\t\t\t\tthis.chapter.modalContent(\n\t\t\t\t\tinput.filter(this.settings.exercise_selector).contents()\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Update asynchronous feedback.\n\t\t\tif (typeof($.aplusExerciseDetectWaits) == \"function\") {\n\t\t\t\tvar exercise = this;\n\t\t\t\tvar id;\n\t\t\t\tif (this.active_element) id = \"#\" + this.chapterID;\n\n\t\t\t\tvar did_wait = $.aplusExerciseDetectWaits(function(suburl, error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\t// Polling for the final feedback failed, possibly because\n\t\t\t\t\t\t// the grading takes a lot of time.\n\t\t\t\t\t\tif (exercise.active_element) {\n\t\t\t\t\t\t\texercise.dispatchEventToActiveElem(\"aplus:exercise-submission-failure\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\t\t\tnew CustomEvent(\"aplus:exercise-submission-failure\",\n\t\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\t\t\t// Reload the exercise (description) in case it changes after submitting.\n\t\t\t\t\t\t\t// This also resets the disabled submit button.\n\t\t\t\t\t\t\texercise.load(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t$.ajax(suburl).done(function(data) {\n\t\t\t\t\t\tif (exercise.active_element) {\n\t\t\t\t\t\t\texercise.updateOutput(data);\n\t\t\t\t\t\t\texercise.dispatchEventToActiveElem(\"aplus:submission-finished\");\n\t\t\t\t\t\t\texercise.submit(); // Active element outputs can be chained\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar input2 = $(data);\n\t\t\t\t\t\t\tvar new_badges = input2.find(exercise.settings.submission_point_badges_selector);\n\t\t\t\t\t\t\tvar old_badges = exercise.element.find(exercise.settings.summary_selector + \" .badge\");\n\t\t\t\t\t\t\told_badges.eq(0).replaceWith(new_badges.eq(0).clone()); // summary points badge (best submission)\n\t\t\t\t\t\t\told_badges.eq(2).replaceWith(new_badges.eq(1).clone()); // points badge of this submission\n\t\t\t\t\t\t\tvar content = input2.filter(exercise.settings.exercise_selector).contents();\n\t\t\t\t\t\t\tif (content.text().trim() == \"\") {\n\t\t\t\t\t\t\t\texercise.chapter.modalSuccess(exercise.element, new_badges.eq(1).clone());\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\texercise.chapter.modalContent(content);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\t\t\tnew CustomEvent(\"aplus:submission-finished\",\n\t\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\t\t\t// Reload the exercise (description) in case it changes after submitting.\n\t\t\t\t\t\t\t// This also resets the disabled submit button.\n\t\t\t\t\t\t\texercise.load(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}).fail(function() {\n\t\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\t\tnew CustomEvent(\"aplus:exercise-submission-failure\",\n\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\t\texercise.chapter.modalError(exercise.chapter.messages.error);\n\t\t\t\t\t\texercise.load(true);\n\t\t\t\t\t});\n\t\t\t\t}, id);\n\t\t\t\tif (!did_wait) {\n\t\t\t\t\t// No asynchronous waiting and polling were needed to retrieve\n\t\t\t\t\t// the feedback for the submission.\n\t\t\t\t\t// Reload the exercise (description) in case it changes after submitting.\n\t\t\t\t\t// This also resets the disabled submit button.\n\t\t\t\t\texercise.load(true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tupdateOutput: function(data) {\n\t\t\t// Put data in this output box\n\t\t\tvar exercise = this;\n\t\t\tvar type = exercise.element.attr(\"data-type\") || \"text\"; // default output type is text\n\t\t\tvar content = $(data);\n\n\t\t\t// The data organisation is different depending on whether it is a new submission or\n\t\t\t// the latest submission that is loaded back\n\t\t\tif (!content.is(\"#feedback\")) {\n\t\t\t\tcontent = content.find(\"#feedback\");\n\t\t\t}\n\n\t\t\tif (type == \"text\") {\n\t\t\t\tcontent = content.text();\n\t\t\t} else if (type == \"image\") {\n\t\t\t\tcontent = '<img src=\"data:image/png;base64, ' + content.text() + '\" />';\n\t\t\t}\n\n\t\t\tvar output_container = exercise.element.find(exercise.settings.ae_result_selector);\n\t\t\toutput_container.html(content);\n\t\t\texercise.element.data('evaluating', false);\n\t\t\t// Some result divs should scale to match the content\n\t\t\tif (typeof exercise.element.data(\"scale\") != \"undefined\" ) {\n\t\t\t\toutput_container.css({ \"height\" : \"auto\"});\n\t\t\t}\n\t\t},\n\n\t\t// Retrieve and update latest values of the input elements related to this element\n\t\tupdateInputs: function(data) {\n\t\t\tdata = data.submission_data;\n\t\t\tvar exercise = this;\n\t\t\t//var [exer, input_list, grader_inputs] = exercise.matchInputs(exercise.element); // ECMAScript 6\n\t\t\tvar tmpInputs = exercise.matchInputs(exercise.element);\n\t\t\tvar exer          = tmpInputs[0],\n\t\t\t    input_list    = tmpInputs[1],\n\t\t\t    grader_inputs = tmpInputs[2];\n\n\t\t\t// Submission data can contain many inputs\n\t\t\t// Changed from A+: submission_data returned from the server has a different format\n\t\t\t// A+ uses arrays like [[\"name\", \"value\"], []...] while Astra uses an object: {name: value}\n\t\t\tfor (var input in data) {\n\t\t\t\tif (!data.hasOwnProperty(input)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar grader_id = input;\n\t\t\t\tvar input_id = input_list[$.inArray(grader_id, grader_inputs)];\n\t\t\t\tvar input_data = data[input];\n\t\t\t\tif ($(\"#\" + input_id).data(\"type\") !== \"file\") {\n\t\t\t\t\t// Store the value of the input to be used later for submitting active\n\t\t\t\t\t// element evaluation requests\n\t\t\t\t\t$($.find(\"#\" + input_id)).data(\"value\", input_data);\n\t\t\t\t\t$(\"#\" +input_id + \"_input_id\").val(input_data).trigger('change');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tdispatchEventToActiveElem: function(event) {\n\t\t\t// Send the event to this active element (output) and all related inputs.\n\t\t\tthis.dom_element.dispatchEvent(\n\t\t\t\tnew CustomEvent(event, {bubbles: true, detail: {type: this.exercise_type}}));\n\t\t\t// Send the event to the inputs related to this output.\n\t\t\t//const [, inputIds, ] = this.matchInputs(this.element); // ECMAScript 6\n\t\t\tvar tmpInputs = this.matchInputs(this.element);\n\t\t\tvar inputIds = tmpInputs[1];\n\n\t\t\t//for (const inputId of inputIds) { // ECMAScript 6, loop over the values of an array\n\t\t\tfor (var i = 0; i < inputIds.length; ++i) {\n\t\t\t\tvar inputId = inputIds[i];\n\t\t\t\tvar inputElem = $('#' + inputId).data('plugin_' + pluginName);\n\t\t\t\tif (inputElem) {\n\t\t\t\t\tinputElem.dom_element.dispatchEvent(\n\t\t\t\t\t\tnew CustomEvent(event,\n\t\t\t\t\t\t\t{bubbles: true, detail: {type: inputElem.exercise_type}}));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tloadLastSubmission: function(input) {\n\t\t\tvar link = input.find(this.settings.last_submission_selector);\n\t\t\tvar exercise = this;\n\t\t\tif (link.length > 0) {\n\t\t\t\tvar url = link.attr(\"href\");\n\n\t\t\t\tif (url && url !== \"#\") {\n\t\t\t\t\tvar data_type = \"html\";\n\t\t\t\t\tif (exercise.active_element) {\n\t\t\t\t\t\t// Active element input values are retrieved from the API, so\n\t\t\t\t\t\t// we must extract the submission number from the submission url\n\t\t\t\t\t\t// TODO these URLs are hardcoded here, but the server could save\n\t\t\t\t\t\t// them to HTML data attributes in order to avoid hardcoding\n\t\t\t\t\t\tvar m = url.match(/submission\\.php\\?id=(\\d+)$/);\n\t\t\t\t\t\tif (m) {\n\t\t\t\t\t\t\turl = 'submission_data.php?id=' + m[1];\n\t\t\t\t\t\t\tdata_type = \"json\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.error('Can not read the submission data URL');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.showLoader(\"load\");\n\t\t\t\t\t$.ajax(url, {dataType: data_type})\n\t\t\t\t\t\t.fail(function() {\n\t\t\t\t\t\t\texercise.showLoader(\"error\");\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data) {\n\t\t\t\t\t\t\texercise.hideLoader();\n\n\t\t\t\t\t\t\tif (!exercise.active_element) {\n\t\t\t\t\t\t\t\tvar f = exercise.element.find(exercise.settings.response_selector)\n\t\t\t\t\t\t\t\t\t.empty().append(\n\t\t\t\t\t\t\t\t\t\t$(data).filter(exercise.settings.exercise_selector).contents()\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\t\t\t\tnew CustomEvent(\"aplus:exercise-loaded\",\n\t\t\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\t\t\t\t//f.removeClass('group-augmented'); // changed from A+: no group submissions in Astra\n\t\t\t\t\t\t\t\texercise.bindFormEvents(exercise.element);\n\t\t\t\t\t\t\t\texercise.dom_element.dispatchEvent(\n\t\t\t\t\t\t\t\t\tnew CustomEvent(\"aplus:exercise-ready\",\n\t\t\t\t\t\t\t\t\t\t{bubbles: true, detail: {type: exercise.exercise_type}}));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Update the output box values\n\t\t\t\t\t\t\t\texercise.updateOutput(data.feedback);\n\n\t\t\t\t\t\t\t\t// Update the input values\n\t\t\t\t\t\t\t\texercise.updateInputs(data);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\texercise.renderMath();\n\t\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// the math must be rendered here even if there is no submission to load\n\t\t\t\t\texercise.renderMath();\n\t\t\t\t}\n\t\t\t}\n\t\t\texercise.chapter.nextExercise();\n\t\t},\n\n\t\tshowLoader: function(messageType) {\n\t\t\tthis.loader.show().find(this.settings.message_selector)\n\t\t\t\t.text(this.chapter.messages[messageType]);\n\t\t\tif (messageType == \"error\") {\n\t\t\t\tthis.loader.removeClass(\"progress-bar-animated\").addClass(\"bg-danger\");\n\t\t\t} else {\n\t\t\t\tthis.loader.addClass(\"progress-bar-animated\").removeClass(\"bg-danger\");\n\t\t\t}\n\t\t},\n\n\t\thideLoader: function() {\n\t\t\tthis.loader.hide();\n\t\t},\n\t\t\n\t\trenderMath: function() {\n\t\t\t// changed from A+: Moodle has its own API for accessing MathJax.\n\t\t\t// Trigger Moodle JS event so that MathJax renders new formulas\n\t\t\t// that were modified/inserted (usually) by AJAX after the initial page load.\n\t\t\t// This uses the Moodle filter MathJax loader.\n\t\t\t// The selector id is like \"chapter-exercise-1\", the element that contains\n\t\t\t// the embedded exercise in the chapter page.\n\t\t\tmoodleEvent.notifyFilterContentUpdated('#' + this.element.attr('id'));\n\t\t},\n\t});\n\n\t$.fn[pluginName] = function(chapter, options) {\n\t\treturn this.each(function() {\n\t\t\tif (!$.data(this, \"plugin_\" + pluginName)) {\n\t\t\t\t$.data(this, \"plugin_\" + pluginName, new AplusExercise(this, chapter, options));\n\t\t\t}\n\t\t});\n\t};\n\n\t$.fn[loadName] = function() {\n\t\treturn this.each(function() {\n\t\t\tvar exercise = $.data(this, \"plugin_\" + pluginName);\n\t\t\tif (exercise) {\n\t\t\t\texercise.load();\n\t\t\t}\n\t\t});\n\t};\n\n})(jQuery, moodleEvent, window, document);\n\n/**\n * Prevent double submit of exercise forms\n */\n(function ($) {\n\t$(document).on('aplus:exercise-loaded', function(e) {\n\t\t$(e.target).find('form').each(function () {\n\t\t\tvar $form = $(this);\n\t\t\tif ($form.prop('method') == 'post') {\n\t\t\t\t$form.on('submit', function (e) {\n\t\t\t\t\t$(this).find('[type=\"submit\"]')\n\t\t\t\t\t\t.prop('disabled', true)\n\t\t\t\t\t\t.attr('data-aplus-submit-disabled', 'yes');\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\t$(document).on('aplus:exercise-submission-failure'\n\t\t\t+ ' aplus:submission-finished aplus:submission-aborted', function(e) {\n\t\t$(e.target).find('[data-aplus-submit-disabled]')\n\t\t\t.prop('disabled', false)\n\t\t\t.removeAttr('data-aplus-submit-disabled');\n\t});\n\t$(document).on('hidden.bs.modal', function(e) {\n\t\t// If the user closes the feedback modal while it is polling for\n\t\t// the grading of the submission, the submit button remains disabled.\n\t\t// The modal hidden event does not specify which exercise is open in\n\t\t// the modal, so we can only enable all disabled buttons in the page.\n\t\t$('[data-aplus-submit-disabled]')\n\t\t\t.prop('disabled', false)\n\t\t\t.removeAttr('data-aplus-submit-disabled');\n\t});\n})(jQuery);\n\n"],"file":"aplus_chapter.min.js"}