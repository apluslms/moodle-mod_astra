{"version":3,"sources":["../src/aplus_searchselect.js"],"names":["$","defaults","widget_selector","field_selector","search_selector","result_selector","selection_selector","AplusSearchSelect","element","options","timeout","prop","settings","extend","init","prototype","widget","clone","removeAttr","removeClass","insertBefore","hide","self","selection","find","selection_li","remove","each","add_selection","attr","text","result","field","on","event","keyCode","preventDefault","search_options","clearTimeout","setTimeout","focus","search","parents","finish","show_dropdown","is","dropdown","selector","query","val","trim","length","opt","size","show","slice","li","append","value","name","parent","select","fn","data","jQuery","window","document"],"mappings":"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","sourcesContent":["/**\n * A+ select widget (multiple select with search and remove) as an ES6 module for Moodle.\n * In an HTML page, run the following JS code once to activate it:\n * $('.search-select').aplusSearchSelect();\n * (The targeted element should be a <select> element.)\n * \n * Source: A+ (a-plus/assets/js/aplus.js)\n * License: GNU GPL v3\n * \n * @module mod_astra/aplus_searchselect\n */\nimport jQuery from 'jquery';\n\n/**\n * Multiple select as search and remove.\n */\n(function($, window, document, undefined) {\n    \"use strict\";\n\n    var pluginName = \"aplusSearchSelect\";\n    var defaults = {\n        widget_selector: \"#search-select-widget\",\n        field_selector: 'input[type=\"text\"]',\n        search_selector: '.dropdown-toggle',\n        result_selector: '.search-options',\n        selection_selector: '.search-selected',\n    };\n\n    function AplusSearchSelect(element, options) {\n        this.element = $(element);\n        this.timeout = null;\n        if (this.element.prop(\"tagName\") == \"SELECT\" && this.element.prop(\"multiple\")) {\n            this.settings = $.extend({}, defaults, options);\n            this.init();\n        }\n    }\n\n    $.extend(AplusSearchSelect.prototype, {\n\n        init: function() {\n            this.widget = $(this.settings.widget_selector).clone()\n                .removeAttr(\"id\").removeClass(\"hide\").insertBefore(this.element);\n            this.element.hide();\n            var self = this;\n            this.selection = this.widget.find(this.settings.selection_selector);\n            this.selection_li = this.selection.find(\"li\").remove();\n            this.element.find(\"option:selected\").each(function(index) {\n                self.add_selection($(this).attr(\"value\"), $(this).text());\n            });\n            this.result = this.widget.find(this.settings.result_selector);\n            this.field = this.widget.find(this.settings.field_selector)\n                .on(\"keypress\", function(event) {\n                    if (event.keyCode == 13) {\n                        event.preventDefault();\n                        self.search_options(true);\n                    }\n                }).on(\"keyup\", function(event) {\n                    if (event.keyCode != 13) {\n                        clearTimeout(self.timeout);\n                        self.timeout = setTimeout(function() {\n                            self.search_options(true);\n                            self.field.focus();\n                        }, 500);\n                    }\n                });\n            this.search = this.widget.find(this.settings.search_selector)\n                .on(\"show.bs.dropdown\", function(event) {\n                    self.search_options();\n                });\n            this.element.parents(\"form\").on(\"submit\", function(event) {\n                self.finish();\n            });\n        },\n\n        search_options: function(show_dropdown) {\n            if (show_dropdown && this.result.is(\":visible\") === false) {\n                this.search.find(\"button\").dropdown(\"toggle\");\n                return;\n            }\n            this.result.find(\"li:not(.not-found)\").remove();\n            this.result.find(\"li.not-found\").hide();\n            var selector = \"option\";\n            var query = this.field.val().trim();\n            if (query.length > 0) {\n                selector += \":contains(\" + this.field.val() + \")\";\n            }\n            var opt = this.element.find(selector);\n            if (opt.size() === 0) {\n                this.result.find(\"li.not-found\").show();\n            } else {\n                var self = this;\n                opt.slice(0,20).each(function(index) {\n                    var li = $('<li><a data-value=\"'+$(this).attr(\"value\")+'\">'+$(this).text()+'</a></li>');\n                    li.find(\"a\").on(\"click\", function(event) {\n                        self.add_selection($(this).attr(\"data-value\"), $(this).text());\n                    });\n                    self.result.append(li);\n                });\n            }\n        },\n\n        add_selection: function(value, name) {\n            if (this.selection.find('[data-value=\"'+value+'\"]').size() === 0) {\n                var li = this.selection_li.clone();\n                var self = this;\n                li.find(\".name\").text(name);\n                li.find(\"button\").attr(\"data-value\", value).on('click', function(event) {\n                    $(this).parent(\"li\").remove();\n                });\n                this.selection.append(li);\n            }\n        },\n\n        finish: function() {\n            this.widget.remove();\n            var select = this.element.show();\n            select.find(\"option:selected\").prop(\"selected\", false);\n            this.selection.find(\"button\").each(function(index) {\n                select.find('option[value=\"'+$(this).attr(\"data-value\")+'\"]').prop(\"selected\", true);\n            });\n        }\n    });\n\n    $.fn[pluginName] = function(options) {\n        return this.each(function() {\n            if (!$.data(this, \"plugin_\" + pluginName)) {\n                $.data(this, \"plugin_\" + pluginName, new AplusSearchSelect(this, options));\n            }\n        });\n    };\n})(jQuery, window, document);\n\n"],"file":"aplus_searchselect.min.js"}