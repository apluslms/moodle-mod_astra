define ("mod_astra/aplus_poll",["jquery"],function(a){"use strict";a=function(a){return a&&a.__esModule?a:{default:a}}(a);(function(a,b){var c={poll_url_attr:"data-poll-url",ready_url_attr:"data-ready-url",poll_delays:[2,3,5,5,5,10,10,10,10],message_selector:".progress-bar",message_attr:{error:"data-msg-error",timeout:"data-msg-timeout"}};function d(b,d,e){this.element=a(b);this.callback=d;this.settings=a.extend({},c,e);this.url=null;this.count=0;this.init()}a.extend(d.prototype,{init:function init(){this.element.show();this.url=this.element.attr(this.settings.poll_url_attr);this.schedule()},poll:function poll(){var b=this;a.ajax(this.url,{dataType:"html"}).fail(function(){b.message("error");b.ready(!0)}).done(function(a){b.count++;if("ready"===a.trim()||"error"===a.trim()||"unofficial"===a.trim()){b.ready()}else if(b.element.is(":visible")){if(b.count<b.settings.poll_delays.length){b.schedule()}else{b.message("timeout");b.ready(!0)}}})},schedule:function schedule(){var a=this;setTimeout(function(){a.poll()},1e3*this.settings.poll_delays[this.count])},ready:function ready(c){if(a.data(this.element.get(0),"plugin_aplusExercisePoll"))a.removeData(this.element.get(0),"plugin_aplusExercisePoll");var d=this.element.attr(this.settings.ready_url_attr);if(this.callback){this.callback(d,c)}else{b.location=d}},message:function(b){this.element.find(this.settings.message_selector).removeClass("progress-bar-animated").text(this.element.attr(this.settings.message_attr[b]));if(this.element.attr("data-aplus-active-element")){var c="There was an error while evaluating the element.";if("timeout"==b){c="Evaluation was timed out."}var d=this.element.find(".ae_result").text(c);if(0===d.height())d.height("auto");if(a.data(this.element.get(0),"plugin_aplusExercisePoll")){a.removeData(this.element.get(0),"plugin_aplusExercisePoll")}}else if("error"==b){this.element.find(this.settings.message_selector).addClass("bg-danger")}}});a.fn.aplusExercisePoll=function(b,c){return this.each(function(){if(!a.data(this,"plugin_aplusExercisePoll")){a.data(this,"plugin_aplusExercisePoll",new d(this,b,c))}})};a.aplusExerciseDetectWaits=function(b,c){c=c||".exercise-wait";var d=a(c);if(d.length){d.aplusExercisePoll(b);return!0}return!1}})(a.default,window,document)});
//# sourceMappingURL=aplus_poll.min.js.map
